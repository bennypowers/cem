{{ $cem := index .Site.Data "lsp-benchmark-results-cem" | default dict }}
{{ $wc := index .Site.Data "lsp-benchmark-results-wc-toolkit" | default dict }}

<div class="lsp-benchmark-summary">
  {{ if and $cem.timestamp $wc.timestamp }}
  <div class="benchmark-servers">
    <div class="server-card">
      <h3>CEM LSP</h3>
      <dl>
        <dt>Last Updated</dt>
        <dd>{{ $cem.timestamp }}</dd>
        <dt>Success Rate</dt>
        <dd>{{ if $cem.benchmarks }}
          {{ $total := 0 }}
          {{ $success := 0 }}
          {{ range $name, $bench := $cem.benchmarks }}
            {{ $total = add $total 1 }}
            {{ if $bench.success }}
              {{ $success = add $success 1 }}
            {{ end }}
          {{ end }}
          {{ printf "%.1f%%" (mul (div (float $success) (float $total)) 100) }} ({{ $success }}/{{ $total }})
        {{ end }}</dd>
        <dt>Startup Time (Mean)</dt>
        <dd>{{ if $cem.benchmarks.startup }}{{ printf "%.2fms" $cem.benchmarks.startup.statistics.mean }}{{ end }}</dd>
        {{ if $cem.benchmarks.hover }}
          {{ if $cem.benchmarks.hover.hover_results }}
            <dt>Hover Correctness</dt>
            <dd>
              {{ $totalContent := 0.0 }}
              {{ $count := 0 }}
              {{ range $cem.benchmarks.hover.hover_results }}
                {{ if .avg_content_length }}
                  {{ $totalContent = add $totalContent .avg_content_length }}
                  {{ $count = add $count 1 }}
                {{ end }}
              {{ end }}
              {{ if gt $count 0 }}{{ printf "%.0f chars" (div $totalContent (float $count)) }}{{ end }}
            </dd>
          {{ end }}
        {{ end }}
        {{ if $cem.benchmarks.completion }}
          {{ if $cem.benchmarks.completion.completion_results }}
            <dt>Completion Correctness</dt>
            <dd>
              {{ $totalItems := 0.0 }}
              {{ $count := 0 }}
              {{ range $cem.benchmarks.completion.completion_results }}
                {{ if .avg_item_count }}
                  {{ $totalItems = add $totalItems .avg_item_count }}
                  {{ $count = add $count 1 }}
                {{ end }}
              {{ end }}
              {{ if gt $count 0 }}{{ printf "%.1f items" (div $totalItems (float $count)) }}{{ end }}
            </dd>
          {{ end }}
        {{ end }}
        {{ if $cem.benchmarks.lit_template }}
          {{ if $cem.benchmarks.lit_template.scenario_results }}
            <dt>Template Test Pass Rate</dt>
            <dd>
              {{ $totalTests := 0 }}
              {{ $successfulTests := 0 }}
              {{ range $cem.benchmarks.lit_template.scenario_results }}
                {{ if and .total_tests .successful_tests }}
                  {{ $totalTests = add $totalTests .total_tests }}
                  {{ $successfulTests = add $successfulTests .successful_tests }}
                {{ end }}
              {{ end }}
              {{ if gt $totalTests 0 }}{{ printf "%.0f%%" (mul (div (float $successfulTests) (float $totalTests)) 100) }} ({{ $successfulTests }}/{{ $totalTests }}){{ end }}
            </dd>
          {{ end }}
        {{ end }}
      </dl>
    </div>

    <div class="server-card">
      <h3>wc-toolkit LSP</h3>
      <dl>
        <dt>Last Updated</dt>
        <dd>{{ $wc.timestamp }}</dd>
        <dt>Success Rate</dt>
        <dd>{{ if $wc.benchmarks }}
          {{ $total := 0 }}
          {{ $success := 0 }}
          {{ range $name, $bench := $wc.benchmarks }}
            {{ $total = add $total 1 }}
            {{ if $bench.success }}
              {{ $success = add $success 1 }}
            {{ end }}
          {{ end }}
          {{ printf "%.1f%%" (mul (div (float $success) (float $total)) 100) }} ({{ $success }}/{{ $total }})
        {{ end }}</dd>
        <dt>Startup Time (Mean)</dt>
        <dd>{{ if $wc.benchmarks.startup }}{{ printf "%.2fms" $wc.benchmarks.startup.statistics.mean }}{{ end }}</dd>
        {{ if $wc.benchmarks.hover }}
          {{ if $wc.benchmarks.hover.hover_results }}
            <dt>Hover Correctness</dt>
            <dd>
              {{ $totalContent := 0.0 }}
              {{ $count := 0 }}
              {{ range $wc.benchmarks.hover.hover_results }}
                {{ if .avg_content_length }}
                  {{ $totalContent = add $totalContent .avg_content_length }}
                  {{ $count = add $count 1 }}
                {{ end }}
              {{ end }}
              {{ if gt $count 0 }}{{ printf "%.0f chars" (div $totalContent (float $count)) }}{{ end }}
            </dd>
          {{ end }}
        {{ end }}
        {{ if $wc.benchmarks.completion }}
          {{ if $wc.benchmarks.completion.completion_results }}
            <dt>Completion Correctness</dt>
            <dd>
              {{ $totalItems := 0.0 }}
              {{ $count := 0 }}
              {{ range $wc.benchmarks.completion.completion_results }}
                {{ if .avg_item_count }}
                  {{ $totalItems = add $totalItems .avg_item_count }}
                  {{ $count = add $count 1 }}
                {{ end }}
              {{ end }}
              {{ if gt $count 0 }}{{ printf "%.1f items" (div $totalItems (float $count)) }}{{ end }}
            </dd>
          {{ end }}
        {{ end }}
        {{ if $wc.benchmarks.lit_template }}
          {{ if $wc.benchmarks.lit_template.scenario_results }}
            <dt>Template Test Pass Rate</dt>
            <dd>
              {{ $totalTests := 0 }}
              {{ $successfulTests := 0 }}
              {{ range $wc.benchmarks.lit_template.scenario_results }}
                {{ if and .total_tests .successful_tests }}
                  {{ $totalTests = add $totalTests .total_tests }}
                  {{ $successfulTests = add $successfulTests .successful_tests }}
                {{ end }}
              {{ end }}
              {{ if gt $totalTests 0 }}{{ printf "%.0f%%" (mul (div (float $successfulTests) (float $totalTests)) 100) }} ({{ $successfulTests }}/{{ $totalTests }}){{ end }}
            </dd>
          {{ end }}
        {{ end }}
      </dl>
    </div>
  </div>
  {{ else }}
  <p><em>No LSP benchmark data available. Run <code>make bench-lsp</code> to generate results.</em></p>
  {{ end }}
</div>

<style>
.lsp-benchmark-summary {
  margin: 2em 0;
}

.benchmark-servers {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5em;
  margin: 1em 0;
}

.server-card {
  background: var(--sl-color-bg-nav);
  border: 1px solid var(--sl-color-gray-5);
  border-radius: 0.5rem;
  padding: 1.5em;
}

.server-card h3 {
  margin-top: 0;
  color: var(--sl-color-white);
}

.server-card dl {
  display: grid;
  grid-template-columns: auto 1fr;
  gap: 0.5em 1em;
  margin: 0;
}

.server-card dt {
  font-weight: 600;
  color: var(--sl-color-gray-2);
}

.server-card dd {
  margin: 0;
  color: var(--sl-color-white);
  font-variant-numeric: tabular-nums;
}
</style>
