{{- $fuseSearchScript := resources.Get "js/fuse-search.js" | resources.ExecuteAsTemplate "js/fuse-search.js" . }}
<script type="module" src="{{ $fuseSearchScript.Permalink }}"></script>
<fuse-search base-url="{{ site.BaseURL }}">
  <template shadowrootmode="open">
    <style>
      :host {
        display: block;
        position: relative;
      }

      form {
        display: contents;

        input[type="search"] {
          width: 100%;
          padding: 0.5rem;
          border: 1px solid light-dark(#ccc, #555);
          border-radius: 4px;
          font-size: 1rem;
          background: light-dark(white, #333);
          color: light-dark(black, white);
        }

        button {
          display: none;
        }
      }

      div[role="listbox"] {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: light-dark(white, #333);
        border: 1px solid light-dark(#ccc, #555);
        border-top: none;
        border-radius: 0 0 4px 4px;
        max-height: 300px;
        overflow-y: auto;
        z-index: 1000;
        display: none;

        &.active {
          display: block;
        }

        a {
          display: block;
          padding: 0.75rem;
          border-bottom: 1px solid light-dark(#eee, #444);
          color: inherit;
          text-decoration: none;
          transition: background-color 0.2s;

          &:hover,
          &.active {
            background-color: light-dark(#f5f5f5, #444);
          }

          &:last-child {
            border-bottom: none;
          }

          h3 {
            margin: 0;
            font-size: 0.9rem;
            font-weight: 600;
          }

          p {
            margin: 0.25rem 0 0 0;
            font-size: 0.8rem;
            color: light-dark(#666, #ccc);
            line-height: 1.3;
          }
        }

        [role="status"] {
          padding: 1rem;
          text-align: center;
          color: light-dark(#666, #ccc);
          font-style: italic;
        }
      }
    </style>

    <form action="https://duckduckgo.com/" method="get" target="_blank">
      <input type="hidden" name="sites" value="bennypowers.dev/cem">
      <search>
        <input type="search"
               name="q"
               placeholder="Search documentation..."
               autocomplete="off"
               aria-label="Search">
        <button type="submit">Search</button>
      </search>
    </form>
    <div role="listbox" aria-label="Search results"></div>
  </template>
</fuse-search>
