{{- $fuseSearchScript := resources.Get "js/fuse-search.js" | resources.ExecuteAsTemplate "js/fuse-search.js" . }}
<script type="module" src="{{ $fuseSearchScript.Permalink }}"></script>
<fuse-search base-url="{{ site.BaseURL }}">
  <template shadowrootmode="open">
    <style>
      :host {
        position: relative;
        display: block;
      }
      form {
        search {
          display: flex;
          padding: 0.5rem 1.5rem;
          gap: 0.5rem;
          align-items: center;
          border-radius: 1.5rem;
          width: 13.5rem;
          border: 1px solid var(--color-search-border);
          color: var(--color-text);
          box-shadow: 0 1rem 4rem rgba(0,0,0,0.17);
          &:has(:hover, :focus) {
            background: var(--color-search-bg);
          }
          svg {
            width: 1rem;
            aspect-ratio: 1;
            opacity: 0.33;
            fill: var(--color-text);
          }
          input {
            outline: none;
            border: none;
            background: transparent;
          }
        }
        button {
          display: none;
        }
      }

      div[role="listbox"] {
        width: 16rem;
        background-color: var(--color-overlay);
        border-radius: 0 0 0.25rem 0.25rem;
        box-shadow: 0 1rem 4rem rgba(0,0,0,0.17);
        position: absolute;
        inset-block-start: 90%;
        display: none;
        overflow: hidden;
        z-index: 5;

        &.active {
          display: grid;
        }

        &:empty {
          display: none;
        }

        a {
          padding: 0.5rem 1rem;
          display: block;
          color: inherit;
          text-decoration: none;

          &:not(.passive):hover,
          &[aria-selected="true"] {
            background-color: var(--color-theme);
            color: var(--color-light);
          }

          &.passive {
            display: grid;
          }

          h3 {
            margin: 0;
            font-size: 0.9rem;
            font-weight: 600;
          }

          p {
            margin: 0.25rem 0 0 0;
            font-size: 0.8rem;
            line-height: 1.3;
          }
        }

        [role="status"] {
          padding: 0.5rem 1rem;
          background: var(--theme);
          color: var(--light);
          font-size: 0.9rem;
          opacity: 0.87;
          text-transform: uppercase;
        }
      }
    </style>

    <form action="https://duckduckgo.com/" method="get" target="_blank">
      <input type="hidden" name="sites" value="bennypowers.dev/cem">
      <search>
        <svg viewBox="0 0 511.999 511.999">
          <path d="M508.874 478.708 360.142 329.976c28.21-34.827 45.191-79.103 45.191-127.309C405.333 90.917 314.416.0 202.666.0S0 90.917.0 202.667s90.917 202.667 202.667 202.667c48.206.0 92.482-16.982 127.309-45.191l148.732 148.732c4.167 4.165 10.919 4.165 15.086.0l15.081-15.082c4.165-4.166 4.165-10.92-.001-15.085zM202.667 362.667c-88.229.0-160-71.771-160-160s71.771-160 160-160 160 71.771 160 160-71.771 160-160 160z"></path>
        </svg>
        <input type="search"
               name="q"
               placeholder="Search site"
               autocomplete="off"
               aria-label="Search site">
      </search>
      <button type="submit">Search</button>
    </form>
    <div role="listbox" aria-label="Search results"></div>
  </template>
</fuse-search>
