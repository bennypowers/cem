// Generated by cem export - do not edit
import React, { forwardRef, useRef, useEffect, type HTMLAttributes, type Ref } from 'react';
import '{{ .ImportPath }}';

export interface {{ .ComponentName }}Props extends HTMLAttributes<HTMLElement> {
{{- range .Attributes }}
  /** {{ .Summary }} */
  {{ .Name | or .FieldName }}?: {{ .Type }};
{{- end }}
{{- range .Properties }}
  /** {{ .Summary }} */
  {{ .Name }}?: {{ .Type }};
{{- end }}
{{- range .Events }}
{{- if not .IsNative }}
  /** {{ .Summary }} */
  {{ .ReactName }}?: (event: {{ .Type }}) => void;
{{- end }}
{{- end }}
}

/** {{ .Summary }} */
export const {{ .ComponentName }} = forwardRef(function {{ .ComponentName }}(
  props: {{ .ComponentName }}Props,
  forwardedRef: Ref<HTMLElement>,
) {
  const innerRef = useRef<HTMLElement>(null);
  const ref = (forwardedRef ?? innerRef) as React.RefObject<HTMLElement>;

  const {
{{- range .Attributes }}
    {{ .Name | or .FieldName }},
{{- end }}
{{- range .Properties }}
    {{ .Name }},
{{- end }}
{{- range .Events }}
{{- if not .IsNative }}
    {{ .ReactName }},
{{- end }}
{{- end }}
    children,
    ...rest
  } = props;

  // Sync properties to the underlying element
  useEffect(() => {
    const el = ref.current;
    if (!el) return;
{{- range .Attributes }}
{{- if .FieldName }}
    if ({{ .FieldName }} !== undefined) (el as any).{{ .FieldName }} = {{ .FieldName }};
{{- end }}
{{- end }}
{{- range .Properties }}
    if ({{ .Name }} !== undefined) (el as any).{{ .Name }} = {{ .Name }};
{{- end }}
  }, [ref,{{ range .Attributes }}{{ if .FieldName }} {{ .FieldName }},{{ end }}{{ end }}{{ range .Properties }} {{ .Name }},{{ end }}]);

  // Bind event listeners
  useEffect(() => {
    const el = ref.current;
    if (!el) return;
    const cleanups: (() => void)[] = [];
{{- range .Events }}
{{- if not .IsNative }}
    if ({{ .ReactName }}) {
      const handler = {{ .ReactName }} as EventListener;
      el.addEventListener('{{ .Name }}', handler);
      cleanups.push(() => el.removeEventListener('{{ .Name }}', handler));
    }
{{- end }}
{{- end }}
    return () => cleanups.forEach(fn => { fn(); });
  }, [ref,{{ range .Events }}{{ if not .IsNative }} {{ .ReactName }},{{ end }}{{ end }}]);

  return React.createElement(
    '{{ .TagName }}',
    {
      ...rest,
      ref,
{{- range .Attributes }}
{{- if not .FieldName }}
{{- if .IsBoolean }}
      {{ .Name | jsKey }}: {{ .Name }} ? '' : undefined,
{{- else }}
      {{ .Name | jsKey }}: {{ .Name }},
{{- end }}
{{- end }}
{{- end }}
    },
    children,
  );
});
