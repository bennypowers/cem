<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Analyzer Benchmarks</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.16.0/cdn/shoelace.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.16.0/dist/themes/light.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.16.0/dist/themes/dark.css">
  <link rel="stylesheet" href="site.css">
</head>
<body>
  <header>
    <div class="header-group">
      <sl-icon-button id="open-drawer-btn" name="list" label="Open navigation"></sl-icon-button>
      <h1><code>@pwrs/cem</code></h1>
    </div>
    <sl-switch id="theme-toggle" checked>Dark Mode</sl-switch>
  </header>

  <sl-drawer label="Navigation" placement="start" id="nav-drawer">
    <nav>
      <sl-menu>
        <sl-menu-item value="readme"><sl-icon name="house-door"></sl-icon> Home</sl-menu-item>
        <sl-menu-item value="benchmarks"><sl-icon name="bar-chart"></sl-icon> Benchmarks</sl-menu-item>
      </sl-menu>
    </nav>
  </sl-drawer>

  <main>
    <sl-tab-group placement="top" style="margin-bottom:2rem;">
      <sl-tab slot="nav" panel="panel-readme">
        <sl-icon name="house-door"></sl-icon>README
      </sl-tab>
      <sl-tab slot="nav" panel="panel-benchmarks">
        <sl-icon name="bar-chart"></sl-icon>Benchmarks
      </sl-tab>
      <sl-tab-panel name="panel-readme">
        <article class="readme-content markdown-body">
          {{ readmeHtml | safe }}
        </article>
      </sl-tab-panel>
      <sl-tab-panel name="panel-benchmarks">
        <div class="breadcrumb">
          <sl-breadcrumb>
            <sl-breadcrumb-item href="/">Home</sl-breadcrumb-item>
            <sl-breadcrumb-item href="#" aria-current="page">Benchmarks</sl-breadcrumb-item>
          </sl-breadcrumb>
        </div>
        <sl-alert variant="primary" open>
          <sl-icon slot="icon" name="bar-chart"></sl-icon>
          <strong>Analyzer Benchmarks</strong>
          <div slot="description">
            Automated, reproducible performance and output-size comparisons of leading web components analyzers.<br>
            Data is updated on every push. Try toggling the theme or exploring the metrics below!
          </div>
        </sl-alert>
        <sl-card>
          <div>
            <strong>Number of runs per tool:</strong> {{ results.runs }}<br>
            <strong>Number of files analyzed per run:</strong> {{ results.file_count }}
          </div>
        </sl-card>
        <sl-tab-group placement="top" style="margin-bottom:2rem;">
          <sl-tab slot="nav" panel="panel-summary">
            <sl-icon name="list"></sl-icon>Summary
          </sl-tab>
          <sl-tab slot="nav" panel="panel-details">
            <sl-icon name="file-bar-graph"></sl-icon>Details
          </sl-tab>
          <sl-tab-panel name="panel-summary">
            <div class="summary-cards">
              {% for result in results.results %}
                <sl-card class="analyzer-summary-card">
                  <div slot="header" class="analyzer-summary-header">
                    <sl-icon name="box-seam"></sl-icon>
                    <span class="analyzer-summary-title">{{ result.name }}</span>
                    <sl-badge variant="primary" pill class="analyzer-summary-badge">{{ result.id }}</sl-badge>
                  </div>
                  <div class="analyzer-summary-docslink">
                    <sl-tag size="small" pill>
                      <sl-icon slot="prefix" name="code"></sl-icon>
                      <a href="{{ result.docsUrl }}" target="_blank">
                        Docs
                        <sl-icon slot="suffix" name="box-arrow-up-right"></sl-icon>
                      </a>
                    </sl-tag>
                  </div>
                  <div class="analyzer-summary-stats">
                    <div>
                      <sl-badge variant="success" pill>
                        <sl-icon slot="prefix" name="clock"></sl-icon>
                        {{ result.averageTime }}s
                      </sl-badge>
                      <div class="analyzer-summary-label">Avg Time</div>
                    </div>
                    <div>
                      <sl-badge variant="neutral" pill>
                        <sl-icon slot="prefix" name="file-text"></sl-icon>
                        {{ result.averageSize }}KB
                      </sl-badge>
                      <div class="analyzer-summary-label">Avg Output Size</div>
                    </div>
                    <div>
                      <sl-badge variant="warning" pill>
                        <sl-icon slot="prefix" name="hash"></sl-icon>
                        {{ result.runs | length }}
                      </sl-badge>
                      <div class="analyzer-summary-label">Runs</div>
                    </div>
                  </div>
                  <sl-details summary="Show Command" class="analyzer-summary-command">
                    <sl-input readonly value="{{ result.command }}"></sl-input>
                  </sl-details>
                </sl-card>
              {% endfor %}
            </div>
          </sl-tab-panel>
          <sl-tab-panel name="panel-details">
            <div class="detail-cards">
              {% for result in results.results %}
                <sl-card class="analyzer-detail-card">
                  <div slot="header" class="analyzer-detail-header">
                    <sl-icon name="info"></sl-icon>
                    <span>{{ result.name }} Details</span>
                  </div>
                  <sl-details summary="Run Breakdown" open>
                    <ul class="analyzer-detail-runs">
                      {% for run in result.runs %}
                        {% if run.time is not none %}
                          <li>
                            <sl-badge variant="success" pill>
                              Run {{ run.run }}
                            </sl-badge>
                            <sl-badge variant="primary" pill>
                              <sl-icon slot="prefix" name="clock"></sl-icon>
                              {{ run.time }}s
                            </sl-badge>
                            <sl-badge variant="neutral" pill>
                              <sl-icon slot="prefix" name="file-text"></sl-icon>
                              {{ run.size }}KB
                            </sl-badge>
                          </li>
                        {% else %}
                          <li>
                            <sl-badge variant="danger" pill>
                              Run {{ run.run }} FAILED
                            </sl-badge>
                            {% if run.error %}
                              <sl-details summary="Show Error"><pre>{{ run.error }}</pre></sl-details>
                            {% endif %}
                          </li>
                        {% endif %}
                      {% endfor %}
                    </ul>
                  </sl-details>
                  <sl-details summary="Last Output (JSON)">
                    <sl-copy-button value="{% if result.lastOutput is iterable and result.lastOutput is not string %}{{ result.lastOutput | dump(2) }}{% else %}{{ result.lastOutput or '' }}{% endif %}"></sl-copy-button>
                    <pre class="analyzer-detail-json">{% if result.lastOutput is iterable and result.lastOutput is not string %}
{{ result.lastOutput | dump(2) }}
{% else %}
{{ result.lastOutput or "No output" }}
{% endif %}</pre>
                  </sl-details>
                  {% if result.lastError and result.lastError != '""' %}
                  <sl-alert variant="danger" open>
                    <sl-icon slot="icon" name="exclamation-triangle"></sl-icon>
                    Last error: <pre>{{ result.lastError }}</pre>
                  </sl-alert>
                  {% endif %}
                </sl-card>
              {% endfor %}
            </div>
          </sl-tab-panel>
        </sl-tab-group>
      </sl-tab-panel>
    </sl-tab-group>
  </main>
  <script type="module">
    import { setBasePath } from 'https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.16.0/dist/utilities/base-path.js';
    setBasePath('https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.16.0/dist/');
    const themeToggle = document.getElementById('theme-toggle');
    const updateTheme = () => {
      const dark = themeToggle.checked;
      document.body.setAttribute('class', dark ? 'sl-theme-dark' : 'sl-theme-light');
    };
    themeToggle.addEventListener('sl-change', updateTheme);
    updateTheme();

    // Nav drawer
    const drawer = document.getElementById('nav-drawer');
    document.getElementById('open-drawer-btn').addEventListener('click', () => drawer.show());
    drawer.addEventListener('sl-after-hide', () => drawer.hide());
    const menu = drawer.querySelector('sl-menu');
    const tabGroup = document.querySelector('sl-tab-group');
    menu.addEventListener('sl-select', e => {
      tabGroup.show(e.detail.item.value === 'readme' ? 'panel-readme' : 'panel-benchmarks');
      drawer.hide();
    });
  </script>
</body>
</html>
